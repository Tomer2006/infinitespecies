<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>infinitespecies</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß¨</text></svg>">
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://en.wikipedia.org" crossorigin>


  <link rel="modulepreload" href="app-modular.js">
  <link rel="modulepreload" href="modules/canvas.js">
  <link rel="modulepreload" href="modules/render.js">
  <link rel="modulepreload" href="modules/events.js">
  <link rel="modulepreload" href="modules/data.js">
  <link rel="modulepreload" href="modules/data-common.js">
  <link rel="modulepreload" href="modules/data-eager.js">

  <link rel="modulepreload" href="modules/metrics.js">
  <link rel="modulepreload" href="modules/state.js">
  <link rel="modulepreload" href="modules/landing.js">
</head>

<body>
  <div class="app">
    <div class="topbar" style="visibility:hidden">
      <div class="title">infinitespecies</div>
      <div class="controls">
        <button class="btn secondary" id="backToMenuBtn" title="Return to main menu">üè† Menu</button>

        <select id="providerSelect" class="select" title="Choose provider">
          <option value="google">Google</option>
          <option value="wikipedia">Wikipedia</option>
          <option value="gbif">GBIF</option>
          <option value="ncbi">NCBI Taxonomy</option>
          <option value="col">Catalogue of Life</option>
          <option value="inat">iNaturalist</option>
        </select>
        <button class="btn" id="providerSearchBtn" title="Open provider (hovered/current)">Web Search</button>





        <div class="searchbar" title="Local search (Enter)">
          <svg width="16" height="16" viewBox="0 0 24 24" aria-hidden="true">
            <path fill="rgba(154,163,199,1)"
              d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 0 0 1.57-4.23A6.5 6.5 0 1 0 9.5 16a6.471 6.471 0 0 0 4.23-1.57l.27.28v.79l5 5 1.5-1.5-5-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
          </svg>
          <input id="searchInput" type="search" aria-label="Search organisms"
            placeholder="Search organism or group‚Ä¶ (Enter)" />
          <button class="btn" id="searchBtn" title="Search">Search</button>
          <button class="btn secondary" id="clearBtn" title="Clear search">Clear</button>
          <div class="search-results" id="searchResults" role="listbox" aria-label="Search results" aria-live="polite">
          </div>
        </div>
        <button class="btn" id="surpriseBtn" title="Jump to a random deepest life form">Surprise Me</button>
        <button class="btn" id="fitBtn" title="Fit hovered/current into view">Fit</button>
        <button class="btn secondary" id="copyLinkBtn" title="Copy deep link to this view">Copy Link</button>
        <button class="btn secondary" id="resetBtn" title="Back to root">Reset</button>
      </div>
    </div>

    <div class="breadcrumbs" id="breadcrumbs"></div>

    <div class="stage" id="stage" aria-busy="false">
      <canvas id="view"></canvas>
      <div class="fps" id="fps" aria-live="polite">‚Äî fps</div>
      <div class="big-preview" id="bigPreview" aria-hidden="true">
        <img id="bigPreviewImg" alt="" decoding="async" />
        <div class="empty" id="bigPreviewEmpty" aria-hidden="true">No image</div>
        <div class="cap" id="bigPreviewCap"></div>
      </div>
      <div class="tooltip" id="tooltip">
        <div class="textcol">
          <div class="name"></div>
          <div class="meta"></div>
        </div>
        <div class="actions">
          <button class="ext" id="tooltipSearchBtn" title="Search this name in selected provider">üîé</button>
        </div>
      </div>



      <div class="legend">
        <div><b>Controls</b></div>
        <ul>
          <li><b>Left Click</b>: Zoom into a group</li>
          <li><b>Right Click</b>: Zoom out to parent</li>
          <li><b>Mouse Wheel</b>: Smooth zoom</li>
          <li><b>Middle Drag</b>: Pan the view</li>
          <li><b>Enter</b>: Search; pick a result to jump</li>
          <li><b>F</b>: Fit hovered/current</li>
          <li><b>R</b>: Reset to root</li>
          <li><b>S</b>: Web search hovered/current</li>
          <li><b>?</b>: Toggle help</li>
        </ul>
      </div>

      <div class="loading" id="loading">
        <div class="loader">
          <div class="splash-brand" aria-hidden="true">
            <div class="logo">üß¨</div>
            <div class="brand-title">infinitespecies</div>

          </div>
          <h3><span id="loadingTitle">Loading‚Ä¶</span></h3>
          <div class="stage-info" id="stageInfo" aria-live="polite">Stage 1 of 2</div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-meta"><span id="progressLabel" role="status" aria-live="polite"
              aria-atomic="true">Starting‚Ä¶</span><span id="progressPct">0%</span></div>
          <div id="loadingTimer" style="margin-top: 5px; font-variant-numeric: tabular-nums;">00:00</div>
          <div class="splash-hint" aria-hidden="true">Tip: Press <b>?</b> for help, <b>F</b> to fit, <b>S</b> for web
            search</div>
        </div>
      </div>

      <div class="pulse" id="pulse"></div>
      <div class="puff-link" id="puffLink"><a id="puffLinkAnchor" href="#" download="infinitespecies.png">Download
          PNG</a></div>
    </div>

    <!-- Landing Page -->
    <div class="landing-page" id="landingPage">
      <div class="landing-content">
        <div class="landing-header">
          <div class="landing-logo">üß¨</div>
          <h1 class="landing-title">infinitespecies</h1>
          <p class="landing-tagline">Explore the Tree of Life ‚Äî millions of organisms in one zoomable map.</p>
        </div>

        <div class="landing-menu">
          <button class="landing-btn primary" id="startExplorationBtn">
            <span class="btn-icon">üåç</span>
            <span class="btn-text">Start Exploration</span>
            <span class="btn-hint">Usually takes 1-2 minutes to load</span>
          </button>



          <button class="landing-btn secondary" id="helpBtn">
            <span class="btn-icon">‚ùì</span>
            <span class="btn-text">Help</span>
          </button>

          <button class="landing-btn secondary" id="aboutBtn">
            <span class="btn-icon">‚ÑπÔ∏è</span>
            <span class="btn-text">About</span>
          </button>
        </div>

        <div class="landing-footer">
          <p>Navigate with mouse and keyboard. Press <kbd>?</kbd> for controls.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- JSON Modal -->
  <div class="modal" id="jsonModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Load Custom Taxonomy JSON</div>
        <div style="display:flex;gap:.5rem">
          <button class="btn secondary" id="insertSampleBtn">Insert sample</button>
          <button class="btn secondary" id="cancelLoadBtn">Cancel</button>
          <button class="btn" id="applyLoadBtn">Parse & Load</button>
        </div>
      </div>
      <div class="modal-body">
        <div>
          <div class="filebox">
            <input type="file" id="fileInput" accept=".json,application/json" />
            <span class="error" id="loadError"></span>
          </div>
          <textarea id="jsonText" placeholder='Paste your JSON here...'></textarea>
        </div>
        <div class="side">
          <h4>Supported Schemas</h4>
          <p>1) Array/object with children: <code>{ name, level?, children:[...] }</code>. Level inferred if missing.
          </p>
          <p>2) Nested key map: <code>{ "Life": { "Bacteria": { ... } } }</code>. Auto-transformed.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="modal" id="helpModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">Keyboard Shortcuts & Controls</div>
        <div style="display:flex;gap:.5rem">
          <button class="btn secondary" id="helpCloseBtn" title="Close help">Close</button>
        </div>
      </div>
      <div class="modal-body" style="grid-template-columns:1fr">
        <div class="side" style="grid-column:1">
          <h4>Navigation</h4>
          <p><b>Left Click</b>: Zoom into a group</p>
          <p><b>Right Click</b>: Zoom out to parent</p>
          <p><b>Mouse Wheel</b>: Smooth zoom</p>
          <p><b>Middle Drag</b>: Pan</p>
          <p><b>Hover</b>: Show image preview</p>
          <h4 style="margin-top:.6rem">Keyboard</h4>
          <p><b>S</b>: Web search hovered/current</p>
          <p><b>R</b>: Reset to root</p>
          <p><b>F</b>: Fit current node in view</p>
          <p><b>?</b>: Toggle this help</p>
        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="modal" id="aboutModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <div class="modal-title">About infinitespecies</div>
        <div style="display:flex;gap:.5rem">
          <button class="btn secondary" id="aboutCloseBtn" title="Close about">Close</button>
        </div>
      </div>
      <div class="modal-body" style="grid-template-columns:1fr">
        <div class="side" style="grid-column:1">
          <p>infinitespecies is an interactive web application for exploring the Tree of Life. It provides a zoomable,
            interactive visualization of taxonomic relationships across millions of organisms.</p>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="app-modular.js"></script>
</body>

</html>